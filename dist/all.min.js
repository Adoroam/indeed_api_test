var app=angular.module("app",["ngCookies"]);app.config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0)}]),app.controller("indexCtrl",["$scope","$cookies","$location","ind",function($scope,$cookies,$location,ind){$scope.queryinfo=$location.search(),$scope.xml=!1,$scope.update=function(reset){"page"==reset&&($scope.queryinfo.start="0",$scope.queryinfo.limit="20"),"all"==reset&&($scope.queryinfo.start="0",$scope.queryinfo.limit="20",$scope.queryinfo.date="any",$scope.queryinfo.jobtype="any",$scope.queryinfo.radius="25"),$location.search($scope.queryinfo),ind.get().then(function(d){d.data?($scope.xmltotal=d.data.totalresults[0],$scope.xml=d.data.results[0],"string"==typeof $scope.xml&&($scope.xml=!1)):console.log("nodata")})},$scope.resetPage=function(){$scope.queryinfo.start="0",$scope.queryinfo.limit="20"},$scope.adv={tog:!1,color:"white"},$scope.advtoggle=function(){$scope.adv.tog?($scope.adv.tog=!1,$scope.adv.color="white"):($scope.adv.tog=!0,$scope.adv.color="purple")},$scope.enter=function(event){13==event.keyCode&&$scope.update("page")},$scope.controls=function(direction){var qs=$scope.queryinfo.start,ql=$scope.queryinfo.limit,ta=$scope.xmltotal;if(ta=Number(ta),qs=Number(qs),ql=Number(ql),"hide"==direction)return qs>1?!1:!0;if("show"==direction)return ta>qs+ql?!0:!1;if("end"==direction){var total=qs+ql;return total>=$scope.xmltotal?$scope.xmltotal:total}"next"==direction&&(qs+=ql),"prev"==direction&&(qs-=ql),1>qs&&(qs=0),$scope.queryinfo.start=qs.toString(),$scope.update()},$scope.update("all"),$scope.conversion=function(){var md=$scope.xml.result[0].onmousedown[0],itemstart=md.indexOf("'")+1,itemend=md.lastIndexOf("'"),sig=md.slice(itemstart,itemend),hr=$location.url(),si=hr.indexOf("&jsa=");if(!(si>0)){var jsh=hr+"&jsa="+sig;-1==jsh.indexOf("&inchal")&&(jsh+="&inchal=apiresults"),console.log(jsh),$location.url(jsh)}}}]),app.controller("loginCtrl",["$scope","$cookies","dbservice",function($scope,$cookies,dbservice){$scope.login={username:"",password:""},$scope.isAdmin=$cookies.get("admin"),$scope.isAdmin&&(dbservice.get().then(function(d){$scope.dblist=d.data,$scope.total=$scope.dblist.length}),$scope.reverse=!1,$scope.type="userdate",$scope.limit=void 0,$scope.begin=0,$scope.prev=function(){$scope.begin>=10&&($scope.begin-=10)},$scope.next=function(){var total=$scope.total;$scope.begin<total&&($scope.begin+=10)},$scope.showall=!1,$scope.limitToggle=function(){void 0==$scope.limit?($scope.limit=10,$scope.showall=!0):($scope.limit=void 0,$scope.showall=!1)},$scope.tracking=!1,$scope.trackingToggle=function(){$scope.tracking?$scope.tracking=!1:$scope.tracking=!0})}]),app.factory("ind",function($http,$location){function buildquery(){var str="",parsed=$location.search(),count=0;for(x in parsed)count?str+="&"+x+"="+parsed[x]:(str+="?"+x+"="+parsed[x],count++);return str}var jsondata={get:function(){if(!promise){var promise=$http.get("/data"+buildquery()).success(function(response){return response});return promise}}};return jsondata}),app.factory("dbservice",function($http,$cookies){var isAdmin=$cookies.get("admin");if(isAdmin){var jsondata={get:function(){if(!promise){var promise=$http.post("/admininfo").success(function(response){return response});return promise}}};return console.log("getting json"),jsondata}var test={get:function(){var well="uh oh";return well}};return console.log(test),test}),app.directive("pageControls",function(){return{restrict:"E",transclude:!0,templateUrl:"templates/pc.html"}}),app.directive("advSearch",function(){return{restrict:"E",transclude:!0,templateUrl:"templates/advsearch.html"}}),app.directive("tracking",function(){return{restrict:"E",transclude:!0,templateUrl:"templates/tracking.html"}}),app.filter("decode",function(){return function(input){var decoded=decodeURI(input);return decoded}});